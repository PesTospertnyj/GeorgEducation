<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        $( function() {
            $(".autocomplete-tabs").each(function () {
                var $dropdownContainer = $(this);
                var $dropdownButton = $dropdownContainer.find("button.dropdown-toggle");
                var $dropdownMenu = $dropdownContainer.find(".dropdown-menu");
                var $selectedCarrierDivs = $dropdownContainer.find(".selected-carrier");
                var $carrierTab = $dropdownContainer.find("a[href='#menu1']");
                var $planTab = $dropdownContainer.find("a[href='#menu2']");
                var $planTabContent = $dropdownContainer.find(".planTabContainer");
                var $input = $dropdownContainer.find(".autocomplete-tabs-input");

                $dropdownButton.hide();

                $dropdownButton.on("click", function() {
                    $dropdownMenu.show();
                });
                $input.focus(function () {
                    $dropdownButton.trigger("click");
                });
                $(document).mouseup(function(e)
                {
                    $dropdownButton.trigger("click");
                    if (!$dropdownMenu.is(e.target) && $dropdownMenu.has(e.target).length === 0 && !$input.is(e.target))
                    {
                        $dropdownMenu.hide();
                    }
                });

                $(".carrier-option").click(function () {
                    var $clickedOption = $(this);
                    var carrierId = $clickedOption.data("carrier-id");
                    selectCarrier(carrierId);
                    filterPlans();
                    activatePlanTab();
                    $planTab.click();

                });

                function selectCarrier(carrierId) {
                    $dropdownContainer.data("selected-carrier", carrierId);
                    var selectedCarrierName = $("li[data-carrier-id='" + carrierId + "']").first().text();
                    $selectedCarrierDivs.text(selectedCarrierName);
                    console.log("carrier click " + carrierId);
                }

                function getSelectedCarrierId() {
                    var result =  $dropdownContainer.data("selected-carrier");
                    if (typeof result === "undefined") {
                        return -1;
                    } else {
                        return result;
                    }
                }

                function filterPlans() {
                    $planTabContent.find(".plan-option").each(function() {
                        var $this = $(this);
                        if ($this.data("carrier-id") === getSelectedCarrierId() ) {
                            $this.show();
                        } else {
                            $this.hide();
                        }
                    });
                }

                function activatePlanTab() {
                    $planTab.attr("data-toggle", "tab");
                }

            });
        });
    </script>
</head>
<body>

<div class="container">
    <div class="dropdown autocomplete-tabs">
        <input id="dropdownMenuInput" class="autocomplete-tabs-input" />
        <button id="dropdownMenuButton" class="btn btn-default dropdown-toggle" type="button">Tutorials
            <span class="caret"></span></button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <ul class="nav nav-tabs">
                <li><a data-toggle="tab" href="#menu1">Choose carrier</a></li>
                <li><a href="#menu2" >Choose plan</a></li>
            </ul>

            <div class="tab-content">
                <div id="menu1" class="tab-pane fade in active">
                    <div class="selected-carrier"></div>
                    <ol class="">
                        <li class="" data-carrier-id="1">I'm paying for myself</li>
                        <li class="" data-carrier-id="">I'll choose my insurance later</li>
                    </ol>
                    <div class="">Popular carriers</div>
                    <ol class="">
                        <li class="carrier-option" data-carrier-id="2">Aetna</li>
                        <li class="carrier-option" data-carrier-id="3">Cigna</li>
                    </ol>
                    <div class="">All carriers</div>
                    <ol class="">
                        <li class="carrier-option" data-carrier-id="2">Aetna</li>
                        <li class="carrier-option" data-carrier-id="3">Cigna</li>
                        <li class="carrier-option" data-carrier-id="4">BCBS</li>
                    </ol>
                </div>
                <div id="menu2" class="planTabContainer tab-pane fade">
                    <div class="selected-carrier"></div>
                    <div class="">Popular plans</div>
                    <ol class="">
                        <li class="plan-option" data-carrier-id="2" data-plan-id="2">Aetna HMO</li>
                        <li class="plan-option" data-carrier-id="2" data-plan-id="3">Aetna NYC</li>

                        <li class="plan-option" data-carrier-id="3" data-plan-id="5">Cigna HMO</li>

                        <li class="plan-option" data-carrier-id="4" data-plan-id="8">BCBS HMO</li>
                        <li class="plan-option" data-carrier-id="4" data-plan-id="9">BCBS NYC</li>
                    </ol>
                    <div class="">All plans</div>
                    <ol class="">
                        <li class="plan-option" data-carrier-id="2" data-plan-id="2">Aetna HMO</li>
                        <li class="plan-option" data-carrier-id="2" data-plan-id="3">Aetna NYC</li>
                        <li class="plan-option" data-carrier-id="2" data-plan-id="4">Aetna EPO</li>

                        <li class="plan-option" data-carrier-id="3" data-plan-id="5">Cigna HMO</li>
                        <li class="plan-option" data-carrier-id="3" data-plan-id="6">Cigna NYC</li>
                        <li class="plan-option" data-carrier-id="3" data-plan-id="7">Cigna EPO</li>

                        <li class="plan-option" data-carrier-id="4" data-plan-id="8">BCBS HMO</li>
                        <li class="plan-option" data-carrier-id="4" data-plan-id="9">BCBS NYC</li>
                        <li class="plan-option" data-carrier-id="4" data-plan-id="10">BCBS EPO</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
